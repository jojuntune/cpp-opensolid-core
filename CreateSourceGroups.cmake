MACRO(CREATE_SOURCE_GROUPS ROOT_DIRECTORY)
    SET(PATH_LIST)
    FOREACH(SOURCE_FILE ${ARGN})
        GET_FILENAME_COMPONENT(SOURCE_PATH ${SOURCE_FILE} PATH)
        LIST(APPEND PATH_LIST ${SOURCE_PATH})
    ENDFOREACH(SOURCE_FILE)
    LIST(SORT PATH_LIST)
    LIST(REMOVE_DUPLICATES PATH_LIST)
    FOREACH(GROUP_PATH ${PATH_LIST})
        SET(CONTAINED_SOURCES)
        FOREACH(SOURCE_FILE ${ARGN})
            GET_FILENAME_COMPONENT(SOURCE_PATH ${SOURCE_FILE} PATH)
            IF (${SOURCE_PATH} STREQUAL ${GROUP_PATH})
                LIST(APPEND CONTAINED_SOURCES ${SOURCE_FILE})
            ENDIF(${SOURCE_PATH} STREQUAL ${GROUP_PATH})
        ENDFOREACH(SOURCE_FILE)
        STRING(REPLACE "${ROOT_DIRECTORY}/" "" STRIPPED_PATH ${GROUP_PATH})
        STRING(REGEX REPLACE "/" "\\\\" GROUP_NAME ${STRIPPED_PATH})
        SOURCE_GROUP(${GROUP_NAME} FILES ${CONTAINED_SOURCES})
    ENDFOREACH(GROUP_PATH)
ENDMACRO(CREATE_SOURCE_GROUPS)